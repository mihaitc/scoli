<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en">
<head>
<title>Școli din București</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
<script src="http://code.jquery.com/jquery-1.9.0.js"></script>
<link rel="stylesheet" href="./static/css/leaflet.css" />
<link rel="stylesheet" href="./static/css/scoli.css" />
<link rel="stylesheet" href="./static/css/bootstrap.min.css" />
<script src="./static/js/leaflet.js"></script>
<script src="./static/js/leaflet_providers.js"></script>
<script src="./data/bucuresti.js"></script>

<script type="text/javascript">
  function numberWithCommas(x) {
    return x.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  }

  function initialize() {
    var map_latitude = 44.435599;
    var map_longitude = 26.10194;
    var map_zoom = 13;
   	var streets = L.tileLayer('https://api.tiles.mapbox.com/v4/{id}/{z}/{x}/{y}.png?access_token=pk.eyJ1IjoibWloYWl0YyIsImEiOiJQdlZ3Vk1jIn0.tifaZEFZJjYcbkOBRooqGw', {
  		maxZoom: 18,
  		attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
  			'<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
  			'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
  		id: 'mapbox.streets'
  	});
  	var here_hybrid = L.tileLayer.provider('HERE.hybridDay', {
        app_id: 'e8cITM4ZmLZY5vCISfGG',
        app_code: 'eWDxP5uk72zORpQjf8GANw'
    });
    map = L.map('map', {
        center: [map_latitude, map_longitude],
        zoom: map_zoom,
        layers: [streets]
    });  
    
    var marker_options = {
        weight: 1,
        opacity: 1
    }; 
    
    var base_maps = {"Hibrid": here_hybrid, "Strazi": streets, }
    L.control.layers(base_maps).addTo(map);
  
    $('#school_average').html(json['average']);
    $('#number_schools').html(json['number_schools']);
    $('#number_pupils').html(numberWithCommas(json['number_pupils']));
    var schools = json['schools'];
    for(var i=0; i < schools.length; i++){
      if(schools[i].below_average){
        marker_options.fillColor = "red";
        marker_options.color = "red";
      }
      else {
        marker_options.fillColor = "green";
        marker_options.color = "green";        
      }     
      marker_options.radius =  schools[i].radius;
      marker_options.fillOpacity =  schools[i].fill;
      var marker = L.circleMarker(L.latLng(schools[i].latitude, schools[i].longitude), marker_options).addTo(map);
      var text = schools[i].school_name + "<br />Nota medie: " + schools[i].average_grade;      
      text += "<br/ >Numar elevi: " + schools[i].number_pupils;
      marker.bindPopup(text);
    }    
  }  
</script>


</head>
<body onload="initialize();">
  <div id="info">
     <b>Școlile din București după media notelor</b> <br />
     Media pe oraș: <span id="school_average"></span><br />
     <span id="number_schools"></span> școli și <span id="number_pupils"></span> elevi
   </div>
   <div id="map"></div>
</body>
</html>